
(function($) {
	$.insdep={
		config:{
			path:location.origin+"/static/insdep/"
		},
		ajax:function(c){
			var d={
				url:"",
				async:true,//true异步请求,false同步请求,注：同步请求将锁住浏览器，用户其它操作必须等待请求完成才可以执行
				cache:false,
				type:"POST",
				dataType:"html",
				beforeSend:function(){},
				complete:function(){}
			};
			var n=$.extend(true,d,c);
			n.async?$.ajax(n):$.when($.insdep.ajax_async(n)).done(n.success?n.success:function(data){
	            return data;
	        });
		},
		ajax_async:function(c){
			var d = $.Deferred();
			var n=$.extend(true,c,{
				success: function(r){
					d.resolve(r);
				}
			});
			$.ajax(n);
			return d.promise();
		},
		loader:function(c,callback){
			var c = (typeof c == 'string'?{path:c}:c);
			var d = {
						id:null,
						path:"",
						cache:false
					};
			var opts = $.extend(true,d,c);
			var type=(opts.path.replace(/.*(\/|\\)/, "").split("?")[0]).split(".").pop();
			opts.id=(opts.id==null?Math.random().toString(36).substr(3):opts.id);
			var objs=$("#"+opts.id);
			switch(type){
				case "css":
					var result=(!document.getElementById(opts.id))?$("head").append('<link '+(opts.id?'id="'+opts.id+'"':"")+' href="'+opts.path+'" rel="stylesheet" type="text/css">'):objs;
				break;
				case "js":
				default:
					var result=(!document.getElementById(opts.id))?$("head").append('<script '+(opts.id?'id="'+opts.id+'"':"")+' src="'+opts.path+'" type="text/javascript"></script>'):objs;
			}
			result.ready(function(){
				callback?callback(result,opts):"";
			});
		},
		
		batchLoader:function(args,lists,callback){
			var count=0;
			var length=0;
			$.each(lists,function(index, el) {
				length++;
				args.id=!isNaN(index)?null:index;
				args.path=el;
				$.insdep.loader(args,function(result,opts){
					if (++count === length) {
				      	callback?callback():"";
				    }
				});
			});
		},
		plus:{}
	};

	$.insdep.theme={};
	$.fn.insdep=function(target,args){
		var _this_=this;
		$.insdep.loader({
            id:"insdep-plus-"+target,
            path:$.insdep.config.path+"plus/"+target+"/module.js"
        },function(){
        	eval('$.insdep.plus.'+target+'(_this_,args);');
    	});
	};
	
	




})(jQuery);

