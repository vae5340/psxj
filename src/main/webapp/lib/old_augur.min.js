//全局变量
var dataIndex = 0;
//菜单json字符串格式
var menuList = [
{"id":"F_FacilitiesList","icon":"img/icon/khpj.jpg","invoke":"","link":"/awater/nnwaterSystem/lszzjk/index.html","name":"设施列表","pid":"M_FacilityBaseDatamanage"},
{"id":"F_FileList","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"档案列表","pid":"M_FacilityBaseDatamanage"},
{"id":"M_FacilityBaseDatamanage","name":"设施基础数据管理","className":"fa fa-user","pid":"M_MunicipalMaintenance"},
{"id":"F_DeclarationEntry","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"申报录入","pid":"M_RoadExcavationApproval"},
{"id":"F_AgencyApproval","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"代办审批","pid":"M_RoadExcavationApproval"},
{"id":"F_ApprovalProcessing","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"在办审批","pid":"M_RoadExcavationApproval"},
{"id":"F_CompletionApproval","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"已办结审批","pid":"M_RoadExcavationApproval"},
{"id":"M_RoadExcavationApproval","name":"道路开挖网上审批","className":"fa fa-user","pid":"M_MunicipalMaintenance"},
{"id":"F_TaskManagement","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"工作任务管理","pid":"M_MaintenanceManage"},
{"id":"F_TaskAssessment","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"工作任务考核","pid":"M_MaintenanceManage"},
{"id":"M_MaintenanceManage","name":"养护管理","className":"fa fa-user","pid":"M_MunicipalMaintenance"},
{"id":"F_RoadPosition","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"道路定位","pid":"M_QueryAnalysisGIS"},
{"id":"F_RoadInfoGISQuery","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"道路信息GIS查询","pid":"M_QueryAnalysisGIS"},
{"id":"F_RoadClassification","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"道路分类统计","pid":"M_QueryAnalysisGIS"},
{"id":"M_QueryAnalysisGIS","name":"GIS查询分析","className":"fa fa-user","pid":"M_MunicipalMaintenance"},
{"id":"M_MunicipalMaintenance","name":"市政维护","className":"sssbgl","pid":""},
{"id":"F_CrossSectionalAnalysis","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"横断面分析","pid":"M_PipeNetworkAnalysis"},
{"id":"F_VerticalAnalysis","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"纵剖面分析","pid":"M_PipeNetworkAnalysis"},
{"id":"F_UpDownstreamAnalysis","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"上下游分析","pid":"M_PipeNetworkAnalysis"},
{"id":"M_PipeNetworkAnalysis","name":"管网分析","className":"fa fa-user","pid":"M_PipeNetworkGIS"},
{"id":"F_空间查询","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"空间查询","pid":"M_地图查询"},
{"id":"F_属性查询","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"属性查询","pid":"M_地图查询"},
{"id":"F_快速查询定位","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"快速查询定位","pid":"M_地图查询"},
{"id":"F_管径查询","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"管径查询","pid":"M_地图查询"},
{"id":"F_联合查询","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"联合查询","pid":"M_地图查询"},
{"id":"M_地图查询","name":"地图查询","className":"fa fa-user","pid":"M_PipeNetworkGIS"},
{"id":"F_多边形统计","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"多边形统计","pid":"M_管线统计"},
{"id":"F_按行政区统计","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"按行政区统计","pid":"M_管线统计"},
{"id":"M_管线统计","name":"管线统计","className":"fa fa-user","pid":"M_PipeNetworkGIS"},
{"id":"F_角度量算","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"角度量算","pid":"M_空间量算"},
{"id":"F_面积量算","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"面积量算","pid":"M_空间量算"},
{"id":"F_距离量算","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"距离量算","pid":"M_空间量算"},
{"id":"M_空间量算","name":"空间量算","className":"fa fa-user","pid":"M_PipeNetworkGIS"},
{"id":"F_ServicePlatformMonitor","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"服务平台监控","pid":"M_ServiceReleaseManage"},
{"id":"F_ServiceDirectoryManage","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"服务目录管理","pid":"M_ServiceReleaseManage"},
{"id":"F_ServiceLogManage","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"服务日志管理","pid":"M_ServiceReleaseManage"},
{"id":"M_ServiceReleaseManage","name":"服务发布管理","className":"fa fa-user","pid":"M_PipeNetworkGIS"},
{"id":"M_PipeNetworkGIS","name":"管网GIS","className":"sssbgl","pid":""},
{"id":"F_内河监测数据接入","icon":"img/icon/khpj.jpg","invoke":"changeMenuDataGrid(\"nh\")","link":"","name":"内河监测数据接入","pid":"M_监测数据接收及设备诊断"},
{"id":"F_自建监测数据接入","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"自建监测数据接入","pid":"M_监测数据接收及设备诊断"},
{"id":"F_基础地理数据接入","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"基础地理数据接入","pid":"M_监测数据接收及设备诊断"},
{"id":"F_天网视频接入","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"天网视频接入","pid":"M_监测数据接收及设备诊断"},
{"id":"雷达图","icon":"img/icon/khpj.jpg","invoke":"","link":"/awater/nnwaterSystem/qxyb/qxytShow.jsp","name":"雷达图","pid":"M_监测数据接收及设备诊断"},
{"id":"气象云图","icon":"img/icon/khpj.jpg","invoke":"","link":"/awater/nnwaterSystem/qxtpick/qxt.html","name":"气象云图","pid":"M_监测数据接收及设备诊断"},
{"id":"F_气象信息接入","icon":"img/icon/khpj.jpg","invoke":"changeMenuDataGrid(\"qx\")","link":"","name":"气象信息接入","pid":"M_监测数据接收及设备诊断"},
{"id":"F_水文监测信息接入","icon":"img/icon/khpj.jpg","invoke":"changeMenuDataGrid(\"sw\")","link":"","name":"水文监测信息接入","pid":"M_监测数据接收及设备诊断"},
{"id":"F_泵站监测数据接入","icon":"img/icon/khpj.jpg","invoke":"changeMenuDataGrid(\"bz\")","link":"","name":"泵站监测数据接入","pid":"M_监测数据接收及设备诊断"},
{"id":"M_监测数据接收及设备诊断","name":"监测数据接收及设备诊断","className":"fa fa-user","pid":"M_在线监测"},
{"id":"F_MapDisplay","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"地图显示","pid":"M_DrainageMonitorWarning"},
{"id":"F_DataThematicMapDisplay","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"数据专题图展示","pid":"M_DrainageMonitorWarning"},
{"id":"F_DataCurveDisplay","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"数据曲线图展示","pid":"M_DrainageMonitorWarning"},
{"id":"F_EquipmentList","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"设备列表","pid":"M_DrainageMonitorWarning"},
{"id":"F_MonitorDataList","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"监测数据列表","pid":"M_DrainageMonitorWarning"},
{"id":"F_StatisticalAnalysis","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"统计分析","pid":"M_DrainageMonitorWarning"},
{"id":"F_RainfallAnalysis","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"降雨分析","pid":"M_DrainageMonitorWarning"},
{"id":"F_DataComparison","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"数据对比","pid":"M_DrainageMonitorWarning"},
{"id":"F_AlarmCenter","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"警报中心","pid":"M_DrainageMonitorWarning"},
{"id":"F_MonitoringPointSetting","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"监测点设置","pid":"M_DrainageMonitorWarning"},
{"id":"F_lszzjk","icon":"img/icon/khpj.jpg","invoke":"","link":"/awater/nnwaterSystem/lszzjk/index.html","name":"历史闸站监测","pid":"M_DrainageMonitorWarning"},
{"id":"M_DrainageMonitorWarning","name":"排水监测与预警系统","className":"fa fa-user","pid":"M_在线监测"},
{"id":"M_在线监测","name":"在线监测","className":"sssbgl","pid":""},
{"id":"F_天气预报","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"天气预报","pid":"M_预警调度(事前)"},
{"id":"F_雨情查询","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"雨情查询","pid":"M_预警调度(事前)"},
{"id":"F_水情查询","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"水情查询","pid":"M_预警调度(事前)"},
{"id":"F_内涝预测","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"内涝预测","pid":"M_预警调度(事前)"},
{"id":"F_应急管理联络网","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"应急管理联络网","pid":"M_预警调度(事前)"},
{"id":"F_防汛专家资料库1","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"防汛专家资料库","pid":"M_预警调度(事前)"},
{"id":"F_防涝物资储备资料库","icon":"img/icon/khpj.jpg","invoke":"","link":"nnwaterSystem/AlertDispatch/PrevWatelogSupplies/Index.jsp","name":"防涝物资储备资料库","pid":"M_预警调度(事前)"},
{"id":"F_布防点管理1","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"布防点管理","pid":"M_预警调度(事前)"},
{"id":"F_应急设备管理","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"应急设备管理","pid":"M_预警调度(事前)"},
{"id":"F_救援队伍管理","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"救援队伍管理","pid":"M_预警调度(事前)"},
{"id":"F_应急预案管理1","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"应急预案管理","pid":"M_预警调度(事前)"},
{"id":"M_预警调度(事前)","name":"预警调度(事前)","className":"fa fa-user","pid":"M_防涝应急"},
{"id":"F_泵站实时监控","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"泵站实时监控","pid":"M_应急指挥(事中)"},
{"id":"F_水位实时监控","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"水位实时监控","pid":"M_应急指挥(事中)"},
{"id":"F_历史水位查询","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"历史水位查询","pid":"M_应急指挥(事中)"},
{"id":"F_指挥调度室模式2","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"指挥调度室模式","pid":"M_应急指挥(事中)"},
{"id":"F_倒灌分析","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"倒灌分析","pid":"M_应急指挥(事中)"},
{"id":"F_管网上下游分析","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"管网上下游分析","pid":"M_应急指挥(事中)"},
{"id":"F_管网流向分析","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"管网流向分析","pid":"M_应急指挥(事中)"},
{"id":"F_视频监控","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"视频监控","pid":"M_应急指挥(事中)"},
{"id":"M_应急指挥(事中)","name":"应急指挥(事中)","className":"fa fa-user","pid":"M_防涝应急"},
{"id":"F_一雨一报","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"一雨一报","pid":"M_分析处置(事后)"},
{"id":"F_内涝信息统计","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"内涝信息统计","pid":"M_分析处置(事后)"},
{"id":"F_抢险费用统计","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"抢险费用统计","pid":"M_分析处置(事后)"},
{"id":"M_分析处置(事后)","name":"分析处置(事后)","className":"fa fa-user","pid":"M_防涝应急"},
{"id":"F_积水点信息管理","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"积水点信息管理","pid":"M_管理维护设置"},
{"id":"F_视频设备管理","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"视频设备管理","pid":"M_管理维护设置"},
{"id":"F_液位仪管理","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"液位仪管理","pid":"M_管理维护设置"},
{"id":"F_暴雨级别设置","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"暴雨级别设置","pid":"M_管理维护设置"},
{"id":"F_预警级别设置","icon":"img/icon/khpj.jpg","invoke":"","link":"","name":"预警级别设置","pid":"M_管理维护设置"},
{"id":"M_管理维护设置","name":"管理维护设置","className":"fa fa-user","pid":"M_防涝应急"},
{"id":"M_防涝应急","name":"防涝应急","className":"sssbgl","pid":""}];
//从后台加载菜单，true表示匹配前台，false直接从后台读取菜单
function loadMenuFromService(isPick){
	$.ajax({
		type: "get",
		url:"/agsupport_hangzhou/ac-role!ajaxMenuJson.action",
		async: false,
		dataType: "json",
		success: function(data){
			if(isPick){
				var newMenuList = new Array();
				var k=0;
				for(var i=0;i<window.menuList.length;i++){
					for(var j=0;j<data.length;j++){
						if(window.menuList[i].id==data[j].id){
							newMenuList[k]=window.menuList[i];
							k++;
							break;
						}
					}
				}
				window.menuList = newMenuList;
			}else{
				window.menuList=data;
			}
		},
		error:function(XHR, textStatus, errorThrown){
			alert("error");
		}
	});	
}
//重新加载js文件
function loadJs(file) {
    var head = $("head").remove("script[role='reload']");
    $("<scri" + "pt>" + "</scr" + "ipt>").attr({ role: 'reload', src: file, type: 'text/javascript' }).appendTo(head);
}

//显示一级菜单
function showFirstMenuList() {
	menuLen = menuList.length;
    var menuStr = "";
    for (var i = 0; i < menuLen; i++) {
        if (menuList[i].pid == 0) {
            //根据菜单JSON格式进行迭代循环 class='hover'
            menuStr += "<li ><a class='" + menuList[i].className + "' onclick='showSecondMenu(\"" + menuList[i].id + "\",this)' href='#'>" + menuList[i].name + "</a></li>";
            if (menuList[i].id == 1) {
                //默认显示
                //一级菜单：第一个子系统
                //二级菜单：第一个菜单
                showSecondMenu("M_MunicipalMaintenance");
                showThirdMenu(11);
                //打开三级菜单
                //seperatorOpen();
            }
        }

    }
    $("#topMenu").html(menuStr);
}

//显示左侧二级菜单
function showSecondMenu(menuId, o) {
    //一级菜单点击后的样式
    $(o).parent().addClass("hover").siblings().removeClass("hover");
    //清空二级菜单
    $("#leftMenu").empty();
    //定义变量
    var secondMenuStr = "";
    for (var i = 0; i < menuLen; i++) {
        if (menuList[i].pid == menuId) {
            secondMenuStr += "<li><a href='#' onclick='showThirdMenu(\"" + menuList[i].id + "\")' style='padding:10px 5px 5px;text-align:center'>" +
				"<i class='" + menuList[i].className + "'></i><span class='nav-label'></span><span class='fa arrow'></span>" +
				"<div style='text-align:center; padding:0 15px 5px;text-decoration:none;cursor:pointer;'>" + menuList[i].name + "</div></a></li>";
        }
    }
    $("#leftMenu").html(secondMenuStr);
}

//显示左侧三级菜单
function showThirdMenu(menuId) {
    seperatorOpen();
    var isOn = $("#waistband").attr("rel");
    if (isOn == "-1") {
        waistbandFun("#waistband");
    }

    //清空二级菜单
    //$("#side-menu").empty(); 
    //定义变量
    var thirdMenuStr = "";
    for (var i = 0; i < menuLen; i++) {
        if (menuList[i].pid == menuId) {
            //var event=menuList[i].link==''?menuList[i].link:menuList[i].invoke;
            if (menuList[i].invoke != "") {
                thirdMenuStr += "<li><a class='J_menuItem' onclick='" + menuList[i].invoke + "' data-index=" + dataIndex + ">" +
			"<img src='" + menuList[i].icon + "' style='display: block;width: 50px;border-radius: 50px;overflow: hidden;margin: 0 auto;' />" +
							"<span style='padding-top:8px;color:#333;'>" + menuList[i].name + "</span></a></li>";
            } else if(menuList[i].link != ""){
                thirdMenuStr += "<li><a class='J_menuItem' href='" + menuList[i].link + "' data-index=" + dataIndex + ">" +
			"<img src='" + menuList[i].icon + "' style='display: block;width: 50px;border-radius: 50px;overflow: hidden;margin: 0 auto;'/>" +
							"<span style='padding-top:8px;color:#333;'>" + menuList[i].name + "</span></a></li>";
            } else {
            	thirdMenuStr += "<li><a class='J_menuItem' href='develop.html' data-index=" + dataIndex + ">" +
			"<img src='" + menuList[i].icon + "' style='display: block;width: 50px;border-radius: 50px;overflow: hidden;margin: 0 auto;'/>" +
							"<span style='padding-top:8px;color:#333;'>" + menuList[i].name + "</span></a></li>";
            }
            dataIndex++;
        }
    }
    
    $("#side-menu").html(thirdMenuStr);
    $(".J_menuItem").click(function () {seperatorClose();});
    loadJs("lib/contabs.min.js");
}

var flag = 1;
//关闭伸缩菜单
function seperatorClose() {
    $("#leftDiv").animate({ left: "-400" }, 100);
    //伸缩二、三级菜单时left:"0";伸缩三级菜单：left:"70"//70为二级菜单的宽度
    $("#seperator").animate({ left: "70" }, 100);
    $("#seperator").addClass("seperatorClose").removeClass("seperatorOpen");
    flag = 0;
    $("#page-wrapper").removeAttr("style");
    $("#mapDiv").css("width", ($(window).width()) + "px");
    map.resize(true);
    map.reposition();
}

//打开伸缩菜单
function seperatorOpen() {
    $("#leftDiv").animate({ left: "70" }, 100);
    $("#seperator").animate({ left: "400" }, 100);
    $("#seperator").addClass("seperatorOpen").removeClass("seperatorClose")
    flag = 1;
    $("#page-wrapper").attr({ style: "margin-left:400px;" });
    //$("#mapDiv").css("width",($(window).width()-400)+"px");
    //map.resize(true);
    //map.reposition();
}

function waistbandFun(o) {
    var isOn = $(o).attr("rel");
    if (isOn == "1") {
        $("#funPannel").removeClass("funPannelOn").addClass("funPannelOff");
        $(o).attr("rel", "-1");
        $(o).find("img").attr("src", "img/menu-slide-down.png");
    } else {
        $("#funPannel").removeClass("funPannelOff").addClass("funPannelOn");
        $(o).attr("rel", "1");
        $(o).find("img").attr("src", "img/menu-slide-up.png");
    }
}
function changeMenuDataGrid(type){
	if(type=="sw")
		document.getElementById("leftMenuTable").src="nnwaterSystem/BootstrapDataGrid/bootstrapDataGrid_sw.html";
	else if(type=="qx")
		document.getElementById("leftMenuTable").src="nnwaterSystem/BootstrapDataGrid/bootstrapDataGrid_qx.html";
	else if(type=="nh")
		document.getElementById("leftMenuTable").src="nnwaterSystem/BootstrapDataGrid/bootstrapDataGrid_nh.html";
	else if(type=="bz")
		document.getElementById("leftMenuTable").src="nnwaterSystem/BootstrapDataGrid/bootstrapDataGrid_bz.html";
}
$(function () {
	//从后台加载菜单，true表示匹配前台，false直接从后台读取菜单
	//loadMenuFromService(true);
    //初始化一级菜单
    showFirstMenuList();

    //给左侧栏伸缩注册点击事件
    $("#seperator").click(function () {
        if (flag == 1) {
            //缩进;
            seperatorClose()
        } else {
            //展开;
            seperatorOpen()
        }
    });
});
	